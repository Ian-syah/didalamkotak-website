<!-- ignore empty links with + -->
{{ $headers := findRE "<h[1-3].*?>(.|\n])+?</h[1-3]>" .Content }}
<!-- at least one header to link to -->
{{ $has_headers := ge (len $headers) 1 }}
<!-- a post can explicitly disable Table of Contents with toc: false -->
{{ $show_toc := (eq $.Params.toc true) }}
{{ if and $has_headers $show_toc }}
<nav class="toc_class" id="toc" data-toggle="toc">
  <!-- TOC header -->
  <hr class="hr-gradient hr-sidebar">
  <div class="toc__title">
    Ada apa aja?
  </div>
  <ul class="nav-ul">
    {{ range $i, $header := $headers }}
      {{ $headerLevel := index (findRE "[1-3]" . 1) 0 }}
      {{ $headerLevel := len (seq $headerLevel) }}
      {{ $anchorID := ($header | plainify | htmlEscape | anchorize) }}
      {{ if ne $i 0 }}
        {{ $prevHeaderLevel := index (findRE "[1-3]" (index $headers (sub $i 1)) 1) 0 }}
        {{ $prevHeaderLevel := len (seq $prevHeaderLevel) }}
          {{ if gt $headerLevel $prevHeaderLevel }}
            {{ range seq (sub $headerLevel $prevHeaderLevel) }}
              <ul class="nav-ul">
            {{end}}
          {{end}}
          {{ if lt $headerLevel $prevHeaderLevel }}
            {{ range seq (sub $prevHeaderLevel $headerLevel) }}
              </li></ul></li>
            {{end}}
          {{end}}
          {{ if eq $headerLevel $prevHeaderLevel }}
            </li>
          {{end}}
          <li>
            <a class="" href="#{{ $anchorID }}" id="{{ $anchorID}}">{{ $header | plainify | htmlEscape }}</a>
          {{ if eq $i (sub (len $headers) 1) }}
            {{ range seq (sub $prevHeaderLevel $headerLevel) }}
              </li></ul></li>
            {{end}}
          {{end}}
      {{else}}
      <li>
        <a class="" href="#{{ $anchorID }}">{{ $header | plainify | htmlEscape }}</a>
      {{end}}
    {{end}}
    {{ $firstHeaderLevel := len (seq (index (findRE "[1-3]" (index $headers 0) 1) 0)) }}
    {{ $lastHeaderLevel := len (seq (index (findRE "[1-3]" (index $headers (sub (len $headers) 1)) 1) 0)) }}
    {{ range seq (sub $lastHeaderLevel $firstHeaderLevel) }}
      </li></ul></li>
    {{end}}
  </ul>
  <hr class="hr-gradient hr-sidebar hr-down">
  <div class="nav_arrow">
      <span class="fa fa-arrow-circle-up" title="Ke Atas" onclick="buttonScroll('top')" aria-hidden="true"></span>
      <span class="fa fa-arrow-circle-down" title="Ke Bawah" onclick="buttonScroll('bottom')" aria-hidden="true"></span>
  </div>
</nav>
{{end}}
